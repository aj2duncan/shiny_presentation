---
title: "A Starter for Shiny"
author: "Andrew Duncan"
date: ""
output: ioslides_presentation
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = F, comment = NA, message = F)
library(dplyr)
library(knitr)
```

## What is Shiny?

```{r app_1st_time, echo = FALSE}
shinyApp(ui = shinyUI(fluidPage(
   
   # Application title
   titlePanel("Old Faithful Geyser Data"),
   
   # Sidebar with a slider input for number of bins 
   sidebarLayout(
      sidebarPanel(
         sliderInput(inputId = "bins",
                     label = "Number of bins:",
                     min = 1,
                     max = 50,
                     value = 30)
      ),
      
      # Show a plot of the generated distribution
      mainPanel(
         plotOutput(outputId = "disPlot"),
         textOutput(outputId = "disText")
      )
   )
)),

# Define server logic required to draw a histogram
server = function(input, output) {
   
   output$disPlot <- renderPlot({
      # generate bins based on input$bins from ui.R
      x    <- faithful[, 2] 
      bins <- seq(min(x), max(x), length.out = input$bins + 1)
      
      # draw the histogram with the specified number of bins
      hist(x, breaks = bins, col = 'darkgray', border = 'white')
      
      
   })
   output$disText <- renderText({
     paste("Number of bins:", input$bins)
   })
})
```

## What is Shiny?

- `shiny` package
- Turns `R` into _html_, _css_ and _javascript_.
- Can customise and style it. 

## Should I be interested?

- Sharing
- Interactive
- Online

## Sharing

- Online
    + shiny server
    + shinyapps.io
- Share the code directly

## Some technical details

- Two parts. `ui` and `server`.
- `ui` contains the things the user sees and can change.
- Split into _inputs_ and _outputs_.

```{r app_ui, eval = F}
ui <- shinyUI(fluidPage(
   titlePanel("Old Faithful Geyser Data"),
   sidebarLayout(
      sidebarPanel(
         sliderInput(inputId = "bins", label = "Number of bins:",
                     min = 1, max = 50, value = 30)
         ),
      mainPanel(
         plotOutput(outputId = "disPlot"),
         textOutput(outputId = "disText")
      )
   )
))
```

## Some technical details

- `server` contains the things the user doesn't see (your `R` code).
- needs function dependent on _input_ and _output_.
- specific functions to _render_ the output that the user sees.

```{r app_server, eval = F}
server <- shinyServer(function(input, output) {
   output$disPlot <- renderPlot({
      x    <- faithful[, 2] 
      bins <- seq(min(x), max(x), length.out = input$bins + 1)
      hist(x, breaks = bins, col = 'darkgray', border = 'white')
   })
   output$disText <- renderText({
     paste("Number of bins:", input$bins)
   })
})
```

## The App

```{r app_2nd_time, echo = FALSE}
shinyApp(ui = shinyUI(fluidPage(
   
   # Application title
   titlePanel("Old Faithful Geyser Data"),
   
   # Sidebar with a slider input for number of bins 
   sidebarLayout(
      sidebarPanel(
         sliderInput(inputId = "bins",
                     label = "Number of bins:",
                     min = 1,
                     max = 50,
                     value = 30)
      ),
      
      # Show a plot of the generated distribution
      mainPanel(
         plotOutput(outputId = "disPlot"),
         textOutput(outputId = "disText")
      )
   )
)),

# Define server logic required to draw a histogram
server = function(input, output) {
   
   output$disPlot <- renderPlot({
      # generate bins based on input$bins from ui.R
      x    <- faithful[, 2] 
      bins <- seq(min(x), max(x), length.out = input$bins + 1)
      
      # draw the histogram with the specified number of bins
      hist(x, breaks = bins, col = 'darkgray', border = 'white')
      
      
   })
   output$disText <- renderText({
     paste("Number of bins:", input$bins)
   })
})
```


## Inputs and Outputs

- There are a wide range of inputs and outputs. 
- Different styles are built in. 

```{r shiny_io, echo = FALSE, results = 'asis'}
shiny_io = data_frame(
  inputs = c("Check box, Radio Button","Dates, Numeric  or Text",
             "File Upload", "Slider", "Drop down (select)"),
  outputs = c("HTML", "Plots", "Tables", "Files to download", "Text"))
kable(shiny_io)
```


## Reactive Expressions

- All the `render` functions are _reactive_. They listen!
- Can create other _reactive_ functions that listen.
- Problem is when a function takes a long time.
- Can use `isolate()` with `actionButton()` or `submitButton`.


## `isolate` with `actionButton()`

- Can choose to `isolate` one or more inputs, then listen for `actionButton()`.
- Add an `actionButton()` to the `ui`.

```{r isolate_ui, eval = F}
ui <- shinyUI(fluidPage(
   titlePanel("Old Faithful Geyser Data"),
   sidebarLayout(
      sidebarPanel(
         sliderInput(inputId = "bins", label = "Number of bins:",
                     min = 1, max = 50, value = 30),
         actionButton(inputId = "plot", label = "Action Button")
         ),
      mainPanel(
         plotOutput(outputId = "disPlot"),
         textOutput(outputId = "disText")
      )
   )
))
```

## `isolate` with `actionButton()`

- In `server` we `isolate` the inputs we want to but listen to the `actionButton`.

```{r isolate_server, eval = F}
server <- shinyServer(function(input, output) {
   output$disPlot <- renderPlot({
     input$plot # listen to the actionButton
      x    <- faithful[, 2] 
      isolate({ # isolate the plots which depend on the 'bins' input
        bins <- seq(min(x), max(x), length.out = input$bins + 1)
        hist(x, breaks = bins, col = 'darkgray', border = 'white')
      })
   })
   output$disText <- renderText({
     # could isolate this if we wanted 
     paste("Number of bins:", input$bins)
   })
})
```


## The App

```{r app_3rd_time, echo = FALSE}
shinyApp(ui = shinyUI(fluidPage(
   
   # Application title
   titlePanel("Old Faithful Geyser Data"),
   
   # Sidebar with a slider input for number of bins 
   sidebarLayout(
      sidebarPanel(
         sliderInput(inputId = "bins",
                     label = "Number of bins:",
                     min = 1,
                     max = 50,
                     value = 30),
         actionButton(inputId = "plot", label = "Action Button")
      ),
      
      # Show a plot of the generated distribution
      mainPanel(
         plotOutput(outputId = "disPlot"),
         textOutput(outputId = "disText")
      )
   )
)),

# Define server logic required to draw a histogram
server = function(input, output) {
   
   output$disPlot <- renderPlot({
     input$plot
      # generate bins based on input$bins from ui.R
      x    <- faithful[, 2] 
      isolate({
      bins <- seq(min(x), max(x), length.out = input$bins + 1)
      
      # draw the histogram with the specified number of bins
      hist(x, breaks = bins, col = 'darkgray', border = 'white')
      })
   })
   output$disText <- renderText({
     paste("Number of bins:", input$bins)
   })
})
```

## The `submitButton()`

- The alternative is to add a `submitButton()`.
- This causes everything to wait. 
- Just change the `ui`. 

```{r submit_ui, eval = F}
ui <- shinyUI(fluidPage(
   titlePanel("Old Faithful Geyser Data"),
   sidebarLayout(
      sidebarPanel(
         sliderInput(inputId = "bins", label = "Number of bins:",
                     min = 1, max = 50, value = 30),
         submitButton(text = "Submit Button")
         ),
      mainPanel(
         plotOutput(outputId = "disPlot"),
         textOutput(outputId = "disText")
      )
   )
))
```

## The App
```{r app_4th_time, echo = FALSE}
shinyApp(ui = shinyUI(fluidPage(
   
   # Application title
   titlePanel("Old Faithful Geyser Data"),
   
   # Sidebar with a slider input for number of bins 
   sidebarLayout(
      sidebarPanel(
         sliderInput(inputId = "bins",
                     label = "Number of bins:",
                     min = 1,
                     max = 50,
                     value = 30),
         submitButton(text = "Submit Button")
      ),
      
      # Show a plot of the generated distribution
      mainPanel(
         plotOutput(outputId = "disPlot"),
         textOutput(outputId = "disText")
      )
   )
)),

# Define server logic required to draw a histogram
server = function(input, output) {
   
   output$disPlot <- renderPlot({
      # generate bins based on input$bins from ui.R
      x    <- faithful[, 2]
      bins <- seq(min(x), max(x), length.out = input$bins + 1)
      # draw the histogram with the specified number of bins
      hist(x, breaks = bins, col = 'darkgray', border = 'white')
   })
   output$disText <- renderText({
     paste("Number of bins:", input$bins)
   })
})
```



